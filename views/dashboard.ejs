
<!-- Dashboard Container -->
<div class="dashboard-container" style="padding-top: 0px; margin-top: 0px;">
    <!-- Sidebar will be injected by the layout -->
    <main class="main-content">
        <!-- Welcome Banner -->
        <div class="welcome-card">
            <div class="welcome-content">
                <h2>Welcome back, <%= user.firstName || user.email.split('@')[0] %>!</h2>
                <p>You're making a difference by helping reduce medical waste and providing essential medicines to those in need. Keep up the great work!</p>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon-card icon-donate">
                    <i class="fas fa-pills"></i>
                </div>
                <div class="stat-details">
                    <div class="stat-number"><%= stats.medicinesDonated %></div>
                    <div class="stat-title">Medicines Donated</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon-card icon-receive">
                    <i class="fas fa-hand-holding-medical"></i>
                </div>
                <div class="stat-details">
                    <div class="stat-number"><%= stats.medicinesReceived %></div>
                    <div class="stat-title">Medicines Received</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon-card icon-pending">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-details">
                    <div class="stat-number"><%= stats.pendingRequests %></div>
                    <div class="stat-title">Pending Requests</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon-card icon-people">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-details">
                    <div class="stat-number"><%= stats.peopleHelped %></div>
                    <div class="stat-title">People Helped</div>
                </div>
            </div>
        </div>

        <!-- Medicines Donated Section -->
        <div class="content-section">
            <div class="section-header">
                <h3 class="section-title">Medicines You've Donated</h3>
                <a href="/dashboard/donor" class="view-all">View All <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="medicines-grid">
                <% if (recentDonations && recentDonations.length > 0) { %>
                    <% recentDonations.forEach(donation => { %>
                        <div class="medicine-card">
                            <div class="medicine-image">
                                <% if (donation.imageUrl) { %>
                                    <img src="<%= donation.imageUrl %>" alt="<%= donation.name %>">
                                <% } else { %>
                                    <i class="fas fa-capsules"></i>
                                <% } %>
                                <div class="medicine-status status-<%= donation.status.toLowerCase() %>"><%= donation.status %></div>
                            </div>
                            <div class="medicine-details">
                                <h4 class="medicine-name"><%= donation.name %></h4>
                                <div class="medicine-info">
                                    <div class="medicine-quantity">
                                        <i class="fas fa-capsules"></i> <%= donation.quantity %> <%= donation.unit || 'tablets' %>
                                    </div>
                                    <div class="medicine-expiry">
                                        <i class="fas fa-calendar"></i> <%= new Date(donation.expiry).toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric' }) %>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <button class="action-button btn-details" onclick="viewMedicineDetails('<%= donation._id %>')">Details</button>
                                    <% if (donation.status === 'Available') { %>
                                        <button class="action-button btn-edit" onclick="editMedicine('<%= donation._id %>')">Edit</button>
                                    <% } else if (donation.status === 'Requested') { %>
                                        <button class="action-button btn-track" onclick="trackRequests('<%= donation._id %>')">Track</button>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="empty-state" style="grid-column: 1 / -1; grid-row: 1 / -1;">
                        <i class="fas fa-pills"></i>
                        <h4>No donations yet</h4>
                        <p>Start helping others by donating your unused medicines.</p>
                        <a href="/donate" class="btn btn-primary">Donate Medicine</a>
                    </div>
                <% } %>
            </div>
        </div>

        <!-- Requests Section -->
        <div class="content-section">
            <div class="section-header">
                <h3 class="section-title">Your Medicine Requests</h3>
                <a href="/dashboard/requests" class="view-all">View All <i class="fas fa-arrow-right"></i></a>
            </div>
            <% if (recentRequests && recentRequests.length > 0) { %>
                <table class="requests-table">
                    <thead>
                        <tr>
                            <th>Medicine</th>
                            <th>Quantity</th>
                            <th>Date Requested</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% recentRequests.forEach(request => { %>
                            <tr class="table-row">
                                <td>
                                    <div class="medicine-cell">
                                        <div class="table-med-image">
                                            <% if (request.medicine && request.medicine.imageUrl) { %>
                                                <img src="<%= request.medicine.imageUrl %>" alt="<%= request.medicine.name %>">
                                            <% } else { %>
                                                <i class="fas fa-pills"></i>
                                            <% } %>
                                        </div>
                                        <div>
                                            <div class="medicine-name"><%= request.medicine ? request.medicine.name : 'Medicine' %></div>
                                            <div class="medicine-expiry">
                                                Exp: <%= request.medicine ? new Date(request.medicine.expiry).toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : 'N/A' %>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td><%= request.quantity %> <%= request.medicine ? (request.medicine.unit || 'tablets') : 'units' %></td>
                                <td><%= new Date(request.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %></td>
                                <td><span class="status-badge status-<%= request.status.toLowerCase() %>"><%= request.status %></span></td>
                                <td>
                                    <button class="action-button btn-details" onclick="viewRequestDetails('<%= request._id %>')">
                                        <% if (request.status === 'Pending') { %>
                                            Details
                                        <% } else if (request.status === 'Accepted') { %>
                                            Track
                                        <% } else if (request.status === 'Completed') { %>
                                            Review
                                        <% } else { %>
                                            Details
                                        <% } %>
                                    </button>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            <% } else { %>
                <div class="empty-state">
                    <i class="fas fa-hand-holding-medical"></i>
                    <h4>No requests yet</h4>
                    <p>Browse available medicines and make your first request.</p>
                    <a href="/dashboard/browse" class="btn btn-primary">Browse Medicines</a>
                </div>
            <% } %>
        </div>

        <!-- Expiring Medicines Alert -->
        <% if (expiringMedicines && expiringMedicines.length > 0) { %>
            <div class="content-section">
                <div class="section-header">
                    <h3 class="section-title">⚠️ Expiring Soon</h3>
                </div>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div class="alert-content">
                        <h4>Medicines Expiring Soon</h4>
                        <p>You have <%= expiringMedicines.length %> medicine(s) expiring within 30 days. Consider donating them before they expire.</p>
                        <div class="expiring-list">
                            <% expiringMedicines.forEach(medicine => { %>
                                <div class="expiring-item">
                                    <strong><%= medicine.name %></strong> - 
                                    Expires: <%= new Date(medicine.expiry).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
                                </div>
                            <% }); %>
                        </div>
                    </div>
                </div>
            </div>
        <% } %>
    </main>
</div>

<script>
    // Dashboard interactions
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle active state for nav items
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                navItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Card hover animations
        const cards = document.querySelectorAll('.stat-card, .medicine-card');
        cards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-8px)';
            });
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
        
        // Button interactions
        const buttons = document.querySelectorAll('.action-button, .donate-button');
        buttons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const text = this.textContent.toLowerCase();
                if(text.includes('donate')) {
                    window.location.href = '/donate';
                }
            });
        });
        
        // Notification bell
        const notification = document.querySelector('.notifications');
        if (notification) {
            notification.addEventListener('click', function() {
                // TODO: Implement notification modal
                alert('You have <%= unreadNotifications %> new notifications');
            });
        }
    });

    // Medicine and Request functions
    function viewMedicineDetails(medicineId) {
        // TODO: Implement medicine details modal
        alert('Viewing details for medicine: ' + medicineId);
    }

    function editMedicine(medicineId) {
        // TODO: Implement edit medicine functionality
        alert('Editing medicine: ' + medicineId);
    }

    function trackRequests(medicineId) {
        // TODO: Implement track requests functionality
        alert('Tracking requests for medicine: ' + medicineId);
    }

    function viewRequestDetails(requestId) {
        // TODO: Implement request details modal
        alert('Viewing details for request: ' + requestId);
    }
</script>